{
  "meta": {
    "lastUpdatedBy": "CL Playbook",
    "lastUpdatedAt": "2025-09-25"
  },
  "authoringStandard": {
    "style": "step-by-step",
    "requirements": [
      "Include clickable links for every external step (GitHub, Vercel, etc.).",
      "Spell out exact UI click paths (e.g., Settings → Security → Protection → Preview Deployments).",
      "Provide copy-pasteable terminal commands with placeholders clearly marked.",
      "Never print secrets; refer to them by secret name (e.g., VERCEL_TOKEN)."
    ]
  },
  "repositories": {
    "canonical": {
      "owner": "ComplianceLoop",
      "repo": "complianceloop-site",
      "defaultBranch": "main"
    }
  },
  "vercel": {
    "team": { "slug": "compliance-loop" },
    "projects": [
      {
        "name": "complianceloop-site",
        "role": "marketing/docs",
        "notes": "Original canonical project."
      },
      {
        "name": "complianceloop-portal",
        "role": "app/portal",
        "notes": "Phase-1 auth/db; used by CI smoke."
      }
    ],
    "preview": {
      "protection": "enabled",
      "bypassTokenSecretName": "VERCEL_BYPASS_TOKEN",
      "urlResolution": "CI queries Vercel /v6/deployments for READY deployment where meta.githubCommitRef == PR branch and app=complianceloop-portal; falls back to latest READY preview if no branch match."
    }
  },
  "automation": {
    "workflows": [
      {
        "path": ".github/workflows/agent-smoke.yml",
        "purpose": "Wait for Vercel Preview and run smoke test on each PR.",
        "inputs": {
          "env": { "VERCEL_APP": "complianceloop-portal" },
          "secrets": [
            "VERCEL_TOKEN",
            "VERCEL_TEAM_ID",
            "VERCEL_BYPASS_TOKEN (required when preview protection is enabled)"
          ]
        },
        "successCriteria": [
          "Workflow prints preview URL.",
          "Smoke script prints 'Root page probe passed.' and '✅ smoke passed.'"
        ],
        "safeRollback": [
          "Disable or remove the workflow file.",
          "Promote a prior READY deployment in Vercel if needed."
        ]
      }
    ]
  },
  "operationalNotes": [
    "On 2025-09-25 the Agent Smoke workflow succeeded for PR #21 (feat/phase-1-auth-db) after updating the project-specific Vercel Protection Bypass token in repo secret VERCEL_BYPASS_TOKEN.",
    "Preview URLs are dynamic per deployment; CI resolves at runtime.",
    "Repo root currently does not require Node deps to run smoke; Node 20+ is sufficient.",
    "If CI logs show 401 at bypass, update VERCEL_BYPASS_TOKEN with the exact token from the project’s Security → Protection → Preview Deployments."
  ],
  "quickLinks": {
    "githubActions": "https://github.com/ComplianceLoop/complianceloop-site/actions",
    "githubSecrets": "https://github.com/ComplianceLoop/complianceloop-site/settings/secrets/actions",
    "vercelTokens": "https://vercel.com/account/tok
