{
  "meta": {
    "lastUpdatedBy": "CL Playbook",
    "lastUpdatedAt": "2025-09-25"
  },
  "authoringStandard": {
    "style": "step-by-step",
    "requirements": [
      "Include clickable links for every external step (GitHub, Vercel, etc.).",
      "Spell out exact UI clicks/labels (e.g., Settings → Security → Protection → Preview Deployments).",
      "Prefer terminal commands that are copy-pasteable with placeholders clearly marked.",
      "Never print secrets; refer to them by secret name."
    ]
  },
  "repositories": {
    "canonical": {
      "owner": "ComplianceLoop",
      "repo": "complianceloop-site",
      "defaultBranch": "main"
    }
  },
  "vercel": {
    "team": {
      "slug": "compliance-loop"
    },
    "projects": [
      {
        "name": "complianceloop-site",
        "role": "marketing/docs",
        "notes": "Original canonical project."
      },
      {
        "name": "complianceloop-portal",
        "role": "app/portal",
        "notes": "Phase-1 auth/db work. Used for smoke testing in CI."
      }
    ],
    "preview": {
      "protection": "allowed",
      "bypassTokenSecretName": "VERCEL_BYPASS_TOKEN",
      "urlResolution": "CI queries Vercel /v6/deployments for READY deployment with meta.githubCommitRef == PR branch; uses app=complianceloop-portal."
    }
  },
  "automation": {
    "workflows": [
      {
        "path": ".github/workflows/agent-smoke.yml",
        "purpose": "Wait for Vercel Preview and run smoke test on every PR.",
        "inputs": {
          "env": {
            "VERCEL_APP": "complianceloop-portal"
          },
          "secrets": [
            "VERCEL_TOKEN",
            "VERCEL_TEAM_ID",
            "VERCEL_BYPASS_TOKEN (optional if preview protection is disabled)"
          ]
        },
        "successCriteria": [
          "Preview URL resolved for the PR branch",
          "Smoke script exits 0 and prints '✅ smoke passed.'"
        ],
        "safeRollback": [
          "Disable the workflow by setting on.pull_request to an empty list or delete the file.",
          "Re-run previous READY deployment from Vercel if necessary."
        ]
      }
    ]
  },
  "operationalNotes": [
    "Preview URLs are dynamic per deployment; CI resolves at runtime via Vercel API.",
    "If Preview protection is enabled, CI requires secret VERCEL_BYPASS_TOKEN. If not set, smoke will fail fast.",
    "Repo currently has no package.json at root; smoke script runs with Node 20+ without installing dependencies."
  ],
  "quickLinks": {
    "githubSecrets": "https://github.com/ComplianceLoop/complianceloop-site/settings/secrets/actions",
    "vercelTokens": "https://vercel.com/account/tokens",
    "vercelTeamSettings": "https://vercel.com/teams/compliance-loop/settings",
    "vercelProjectSecurity": "https://vercel.com/compliance-loop/complianceloop-portal/settings/security",
    "workflowEdit": "https://github.com/ComplianceLoop/complianceloop-site/edit/main/.github/workflows/agent-smoke.yml",
    "playbookEdit": "https://github.com/ComplianceLoop/complianceloop-site/edit/main/playbook.md",
    "decisionsEdit": "https://github.com/ComplianceLoop/complianceloop-site/edit/main/decisions.json"
  }
}
